---
title: 内存池
tags: [c]
category: 编程
date: 2018-05-17 22:35:34
---

## 内存池的作用

有一种极限的编程方法，为了提高效率，节省内存分配释放的时间，会在开始时就先申请好要使用的内存并且不释放，需要时直接从开始申请好的内存池中获取。

## 内存分配的缺陷

linux采用buddy伙伴分配算法，这种算法每次大小最少为4k，而且有个限制是大内存不能由小内存拼起来且，如果要求16k内存，资源中有4个4k内存是不能直接拼成16k的，依赖于回收算法，大部分情况是重新申请一块16k的内存，极限情况下，内存中大量4k的小内存块，总量很大，但申请的内存因为大于4k不能成功申请到。

## 内存池的设计

对于大量碎片式的小内存块申请和释放，我们可以通过预先申请一个容量的内存池，当程序需要时，先从内存池中获取，释放时放回内存池。

## 内存池设计注意事项

> - linux 用户态的内存申请是lazy模式的，申请时并没有实际申请到，只有实际用到时才会真正申请到资源，如果要在用户态实现预申请的效果，需要在申请后每块写0，资源才会实际申请出来
> - linux内核态下的内存是申请后就实际申请到的
> - 用户态封装libc库函数调用malloc->brk->buddy. 内核态kmalloc->slab->buddy，最终都是调用buddy的伙伴分配算法 